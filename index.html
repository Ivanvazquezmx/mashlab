<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>MashLab v1.1 - Mobile Edition</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231f1f1f' width='100' height='100' rx='20'/><path d='M35 75V25l35-5v45M25 75a10 10 0 1 0 20 0 10 10 0 1 0-20 0M55 65a10 10 0 1 0 20 0 10 10 0 1 0-20 0' fill='none' stroke='%2300ff88' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'/></svg>">
<style>
  :root {
    --bg-gradient: linear-gradient(135deg, #050508 0%, #0a0a15 50%, #050508 100%);
    --glass: rgba(10, 10, 20, 0.95);
    --glass-border: rgba(255, 255, 255, 0.08);
    --text: #ffffff;
    --sub: #94a3b8;
    --ok: #00ff88;    
    --warn: #ffcc00;  
    --pitch: #00e5ff; 
    --blue: #3b82f6;
    --down: #ff3366;
    --accent: #ffffff;
    --linktree: #43e55e;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
  
  body {
    margin: 0; min-height: 100vh;
    background: var(--bg-gradient);
    background-attachment: fixed;
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif;
    overflow-x: hidden;
  }

  .container { max-width: 1000px; margin: 0 auto; padding: 12px 12px 80px; }

  /* Topbar Mobile Friendly */
  .topbar {
    position: sticky; top: 0; z-index: 100;
    background: rgba(5, 5, 10, 0.85);
    backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--glass-border);
  }
  .topbar-inner {
    display: flex; align-items: center; justify-content: space-between;
    height: 60px; max-width: 1000px; margin: 0 auto; padding: 0 16px;
  }

  /* GestiÃ³n de Clips */
  .panel {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 24px; padding: 20px; margin-bottom: 24px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.6);
  }

  h2 { margin: 0; font-size: 18px; font-weight: 700; letter-spacing: -0.5px; }
  h3 { margin: 0 0 12px 0; font-size: 11px; color: var(--sub); text-transform: uppercase; letter-spacing: 1.5px; font-weight: 800; }

  .song-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  @media(max-width:768px){ .song-grid { grid-template-columns: 1fr; gap: 16px; } }

  .song-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--glass-border);
    border-radius: 18px; padding: 12px;
    display: grid; grid-template-columns: 1fr 90px 40px; gap: 10px;
    align-items: center; margin-bottom: 10px;
  }
  @media(max-width:480px) {
    .song-item { grid-template-columns: 1fr 80px 30px; gap: 8px; padding: 10px; }
    .input, .select { font-size: 12px; padding: 8px; }
  }

  .input, .select {
    background: rgba(0, 0, 0, 0.5);
    border: 1px solid var(--glass-border);
    color: #fff; padding: 10px; border-radius: 12px;
  }

  /* Rueda Interactiva */
  .wheel-container {
    display: flex; flex-direction: column; align-items: center;
    background: rgba(0,0,0,0.4); border-radius: 36px; padding: 24px;
    border: 1px solid var(--glass-border); margin-bottom: 24px;
  }
  svg.camelot-wheel { width: 100%; max-width: 480px; height: auto; transform: rotate(-15deg); }
  .segment { cursor: pointer; transition: 0.2s; }

  /* AnÃ¡lisis ArmÃ³nico */
  .analysis-card {
    background: var(--glass);
    border-radius: 28px; padding: 20px; margin-bottom: 20px;
    border: 1px solid var(--glass-border);
  }
  .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; margin-top: 15px; }
  
  @media(max-width:600px) {
    .options-grid { grid-template-columns: 1fr 1fr; }
    .opt-box { padding: 10px; }
  }

  .opt-box {
    background: rgba(255, 255, 255, 0.02);
    padding: 12px; border-radius: 16px; border: 1px solid var(--glass-border);
    text-align: center; cursor: pointer; transition: 0.2s;
  }
  .opt-box.selected { border-color: var(--accent); background: rgba(255, 255, 255, 0.1); }
  
  .color-match { border-color: var(--ok); color: var(--ok); }
  .color-energy { border-color: var(--warn); color: var(--warn); }
  .color-pitchpro { border-color: var(--pitch); color: var(--pitch); }

  /* Botones */
  .btn {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 10px 16px; border-radius: 14px; border: 1px solid var(--glass-border);
    background: rgba(255, 255, 255, 0.05); color: var(--text);
    cursor: pointer; transition: 0.2s; font-weight: 600; font-size: 13px;
  }
  .btn.active { background: #fff; color: #000; border-color: #fff; }

  /* Footer Minimalista */
  .footer {
    margin-top: 40px; text-align: center; border-top: 1px solid var(--glass-border);
    padding: 40px 16px 60px;
  }
  .social-group { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; margin-top: 20px; }
  .social-btn {
    text-decoration: none; color: #fff; background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.1); padding: 10px 20px;
    border-radius: 16px; font-size: 12px; font-weight: 700;
  }
  .social-btn.patreon { border-color: #ff424d; color: #ff424d; }

  .marker-text { font-size: 10px; font-weight: 900; fill: #000; pointer-events: none; }
  .label-cam { font-weight: 800; font-size: 15px; }
  .label-anglo { font-size: 11px; font-weight: 700; }
</style>
</head>
<body>

  <div id="toast" style="position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 12px 24px; border-radius: 16px; font-weight: 700; opacity: 0; transition: 0.3s; z-index: 1000;">Copiado</div>

  <div class="topbar">
    <div class="topbar-inner">
      <div style="font-weight:900; font-size:20px; letter-spacing:-1px">
        <span style="color:var(--ok)">MASH</span>LAB <span style="font-weight:200; opacity:0.6">v1.1</span>
      </div>
      <div style="display:flex; gap:6px; background:rgba(255,255,255,0.04); padding:4px; border-radius:14px">
        <button id="modeVoz" class="btn active" style="padding:6px 12px" onclick="setMode('voz')">Voz</button>
        <button id="modeInst" class="btn" style="padding:6px 12px" onclick="setMode('inst')">Base</button>
      </div>
    </div>
  </div>

  <div class="container">
    
    <!-- GESTIÃ“N DE PISTAS -->
    <div class="panel">
      <div class="song-grid">
        <div id="colVoz">
          <h3>Acapellas</h3>
          <div id="listV"></div>
          <button class="btn" style="width:100%; border-style:dashed; margin-top:10px" onclick="addSong('voz')">âž• AÃ±adir Clip</button>
        </div>
        <div id="colInst">
          <h3>Instrumentales</h3>
          <div id="listI"></div>
          <button class="btn" style="width:100%; border-style:dashed; margin-top:10px" onclick="addSong('inst')">âž• AÃ±adir Clip</button>
        </div>
      </div>
    </div>

    <!-- RUEDA INTERACTIVA -->
    <div class="wheel-container">
      <div style="text-align:center; margin-bottom:20px">
        <h2 style="margin:0">RUEDA DE CAMELOT</h2>
        <p id="guideKeyLabel" style="color:var(--ok); font-size:16px; margin-top:8px; font-weight:800">--</p>
      </div>
      <div id="wheelTarget" style="width:100%; display:flex; justify-content:center"></div>
    </div>

    <!-- ANÃLISIS -->
    <div style="margin-bottom:20px; padding-left:10px">
      <h2 style="font-size:16px; color:var(--sub); margin-bottom: 20px;">Ajustes de Semitonos</h2>
      <div id="analysisContainer"></div>
    </div>

    <footer class="footer">
      <p style="color: var(--sub); font-size: 13px;">Apoya el desarrollo pro de MashLab:</p>
      <div class="social-group">
        <a href="https://www.patreon.com/c/Ivanvazquezmx" target="_blank" class="social-btn patreon">ðŸ’Ž Patreon</a>
        <a href="https://linktr.ee/ivanvazquezmusic" target="_blank" class="social-btn">ðŸŒ³ Linktree</a>
        <a href="https://www.instagram.com/ivanvazquezmx/" target="_blank" class="social-btn">ðŸ“¸ Instagram</a>
      </div>
      <div style="margin-top: 40px; font-size: 10px; opacity: 0.2; letter-spacing: 4px;">MASHLAB v1.1 â€¢ STUDIO</div>
    </footer>
  </div>

<script>
const DATA = {
  "1A":"G#m","2A":"Ebm","3A":"Bbm","4A":"Fm","5A":"Cm","6A":"Gm","7A":"Dm","8A":"Am","9A":"Em","10A":"Bm","11A":"F#m","12A":"Dbm",
  "1B":"B","2B":"F#","3B":"Db","4B":"Ab","5B":"Eb","6B":"Bb","7B":"F","8B":"C","9B":"G","10B":"D","11B":"A","12B":"E"
};
const PC = {
  "1A":8,"2A":3,"3A":10,"4A":5,"5A":0,"6A":7,"7A":2,"8A":9,"9A":4,"10A":11,"11A":6,"12A":1,
  "1B":11,"2B":6,"3B":1,"4B":8,"5B":3,"6B":10,"7B":5,"8B":0,"9B":7,"10B":2,"11B":9,"12B":4
};

let state = JSON.parse(localStorage.getItem('mashlab_state')) || {
  mode: 'voz',
  selectedRel: 'Exacta',
  voices: [{id:1, title:'Clip Voz 1', key:'4B'}],
  insts: [{id:101, title:'Clip Base 1', key:'6A'}],
};

function save() { localStorage.setItem('mashlab_state', JSON.stringify(state)); }

function getShift(from, to) {
  let diff = (PC[to] - PC[from] + 12) % 12;
  return diff > 6 ? diff - 12 : diff;
}

function getTargetKey(guideKey, type) {
  const n = parseInt(guideKey), m = guideKey.slice(-1);
  if (type === 'Exacta') return guideKey;
  if (type === 'Relativa') return `${n}${m === 'A' ? 'B' : 'A'}`;
  if (type === 'Subida') return `${n === 12 ? 1 : n + 1}${m}`;
  if (type === 'Sutil') return `${n === 1 ? 12 : n - 1}${m}`;
  if (type === 'EnergÃ­a') return `${n + 2 > 12 ? (n + 2) - 12 : n + 2}${m}`;
  if (type === 'PitchPro') {
    let p = null, mi = null;
    for (let k in DATA) {
      if (k === guideKey || k.slice(-1) !== m) continue;
      const s = getShift(guideKey, k);
      if (s === 1) p = k; if (s === -1) mi = k;
    }
    return p || mi || guideKey;
  }
  return guideKey;
}

function render() {
  const list = state.mode === 'voz' ? state.voices : state.insts;
  const guideKey = list.length ? list[0].key : "1A";
  document.getElementById('guideKeyLabel').textContent = `${guideKey} (${DATA[guideKey]})`;
  renderList('voz', state.voices);
  renderList('inst', state.insts);
  renderAnalysis(guideKey);
  drawWheel(guideKey);
  save();
}

function renderList(type, songs) {
  const container = document.getElementById(type === 'voz' ? 'listV' : 'listI');
  container.innerHTML = '';
  songs.forEach((s, i) => {
    const isG = state.mode === type && i === 0;
    const div = document.createElement('div');
    div.className = `song-item ${isG ? 'is-guide' : ''}`;
    div.innerHTML = `
      <input type="text" class="input" value="${s.title}" onchange="updateSong('${type}',${s.id},'title',this.value)">
      <select class="select" onchange="updateSong('${type}',${s.id},'key',this.value)">
        ${Object.keys(DATA).map(k => `<option value="${k}" ${k===s.key?'selected':''}>${k}</option>`).join('')}
      </select>
      <button onclick="deleteSong('${type}',${s.id})" style="background:none; border:none; color:var(--down); font-weight:800;">âœ•</button>
    `;
    container.appendChild(div);
  });
}

function renderAnalysis(guideKey) {
  const container = document.getElementById('analysisContainer');
  const targets = state.mode === 'voz' ? state.insts : state.voices;
  if (!targets.length) { container.innerHTML = ""; return; }
  container.innerHTML = targets.map(song => {
    const tk = getTargetKey(guideKey, state.selectedRel);
    const s = getShift(song.key, tk);
    const st = s === 0 ? '0' : (s > 0 ? '+'+s : s);
    return `<div class="analysis-card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
          <div><div style="font-weight:800; font-size:16px">${song.title}</div><div style="font-size:12px; color:var(--sub)">Original: ${song.key}</div></div>
          <div style="text-align:right">
            <div style="font-size:20px; font-weight:900; color:${s===0?'var(--ok)':(s>0?'var(--warn)':'var(--down)')}">${st} st</div>
            <button class="btn" style="padding:4px 10px; font-size:10px; margin-top:5px" onclick="copyToClipboard('${st}')">COPIAR</button>
          </div>
        </div>
        <div class="options-grid">
          ${['Exacta','Relativa','Subida','Sutil','EnergÃ­a','PitchPro'].map(type => {
            const k = getTargetKey(guideKey, type);
            const sh = getShift(song.key, k);
            const isSel = state.selectedRel === type;
            const cat = ['Exacta','Relativa','Subida','Sutil'].includes(type) ? 'match' : (type==='EnergÃ­a'?'energy':'pitchpro');
            return `<div class="opt-box ${isSel ? 'selected' : ''} color-${cat}" onclick="setGlobalRelation('${type}')">
              <div style="font-size:9px; font-weight:800; opacity:0.6">${type.toUpperCase()}</div>
              <div style="font-weight:800; font-size:13px">${k}</div>
              <div style="font-size:14px; font-weight:900">${sh === 0 ? '0' : (sh > 0 ? '+' + sh : sh)}</div>
            </div>`;
          }).join('')}
        </div>
      </div>`;
  }).join('');
}

function drawWheel(guideKey) {
  const target = document.getElementById('wheelTarget');
  const size = 500, cx = 250, cy = 250, rO = 235, rM = 155, rIn = 80;
  let html = `<svg viewBox="0 0 ${size} ${size}" class="camelot-wheel">`;
  for(let i=0; i<12; i++) {
    const s = (i * 30) - 15, e = ((i + 1) * 30) - 15;
    html += drawSeg(cx, cy, rM, rO, s, e, `${i+1}B`, guideKey);
    html += drawSeg(cx, cy, rIn, rM, s, e, `${i+1}A`, guideKey);
  }
  target.innerHTML = html + `</svg>`;
}

function drawSeg(cx, cy, rin, rout, s, e, key, guide) {
  const rad = Math.PI / 180, x1 = cx + rout * Math.cos(s * rad), y1 = cy + rout * Math.sin(s * rad), x2 = cx + rout * Math.cos(e * rad), y2 = cy + rout * Math.sin(e * rad), x3 = cx + rin * Math.cos(e * rad), y3 = cy + rin * Math.sin(e * rad), x4 = cx + rin * Math.cos(s * rad), y4 = cy + rin * Math.sin(s * rad);
  const isA = key === guide, tk = ['Exacta','Relativa','Subida','Sutil','EnergÃ­a','PitchPro'].map(t => getTargetKey(guide, t));
  const isTarget = tk.includes(key);
  let fill = "rgba(255,255,255,0.02)";
  if (isA) fill = "#fff"; 
  else if (isTarget) {
    const type = ['Exacta','Relativa','Subida','Sutil','EnergÃ­a','PitchPro'].find(t => getTargetKey(guide, t) === key);
    if(['Exacta','Relativa','Subida','Sutil'].includes(type)) fill = "rgba(0, 255, 136, 0.4)";
    else if(type==='EnergÃ­a') fill = "rgba(255, 204, 0, 0.5)";
    else fill = "rgba(0, 229, 255, 0.5)";
  }
  const mid = (s + e) / 2, tx = cx + ((rin + rout) / 2) * Math.cos(mid * rad), ty = cy + ((rin + rout) / 2) * Math.sin(mid * rad);
  const vP = state.voices.find(v => v.key === key), bP = state.insts.find(i => i.key === key);
  let m = ""; if(vP) m += `<circle cx="${tx-12}" cy="${ty-15}" r="9" fill="var(--ok)"/><text x="${tx-12}" y="${ty-12}" text-anchor="middle" class="marker-text">V</text>`;
  if(bP) m += `<circle cx="${tx+12}" cy="${ty-15}" r="9" fill="var(--blue)"/><text x="${tx+12}" y="${ty-12}" text-anchor="middle" class="marker-text">B</text>`;
  return `<path d="M ${x1} ${y1} A ${rout} ${rout} 0 0 1 ${x2} ${y2} L ${x3} ${y3} A ${rin} ${rin} 0 0 0 ${x4} ${y4} Z" fill="${fill}" class="segment ${isA?'active':''}" onclick="setKeyFromWheel('${key}')" />
    <g transform="rotate(${mid+90}, ${tx}, ${ty})"><text x="${tx}" y="${ty+3}" text-anchor="middle" class="label-cam" style="fill:${isA?'#000':'#fff'}">${key}</text><text x="${tx}" y="${ty+16}" text-anchor="middle" class="label-anglo" style="fill:${isA?'#333':'rgba(255,255,255,0.6)'}">${DATA[key]}</text></g>${m}`;
}

function setKeyFromWheel(key) { const list = state.mode==='voz'?state.voices:state.insts; if(list.length) updateSong(state.mode, list[0].id, 'key', key); }
function setMode(m) { state.mode = m; document.getElementById('modeVoz').classList.toggle('active', m === 'voz'); document.getElementById('modeInst').classList.toggle('active', m === 'inst'); render(); }
function setGlobalRelation(type) { state.selectedRel = type; render(); }
function addSong(t) { const id = Date.now(), s = { id, title: `Pista ${t==='voz'?'Voz':'Base'}`, key: '8A' }; if(t==='voz') state.voices.push(s); else state.insts.push(s); render(); }
function deleteSong(t, id) { const arr = t==='voz' ? state.voices : state.insts; if(arr.length > 1) { if(t==='voz') state.voices = state.voices.filter(x=>x.id!==id); else state.insts = state.insts.filter(x=>x.id!==id); render(); } }
function updateSong(t, id, f, v) { const arr = t==='voz' ? state.voices : state.insts; const s = arr.find(x=>x.id===id); if(s) { s[f] = v; render(); } }
function copyToClipboard(t) { const el = document.createElement('textarea'); el.value = t; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el); const toast = document.getElementById('toast'); toast.style.opacity = '1'; setTimeout(() => toast.style.opacity = '0', 2000); }

window.onload = render;
</script>
</body>
</html>
